<!DOCTYPE html>
<html>
<head th:include="/thymeleaf/common/_head::head('订单管理')">
<meta charset="UTF-8">
</head>
<body>
	<div class="container">
		<!-- header -->
		<div th:include="thymeleaf/common/_header::header" class="header"></div>
		<!-- content -->
		<!-- 对话框 -->
		<!-- <div th:replace="thymeleaf/common/_dispatch_account_dialog::dialog" class="header"></div> -->
		<!-- 订单列表 -->
		<div class="row clearfix">
			<div class="col-md-12 column">
				<h3>订单管理</h3>
				<table class="table">
					<thead>
						<tr>
							<th>订单号</th>
							<th>订单时间</th>
							<th>金额</th>
							<th>收货人</th>
							<th>状态</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="order:${orderList}">
							<td th:text="${order.orderId}">订单号</td>
							<td th:text="${#calendars.format(order.orderTime,'yyyy-MM-dd HH:mm:ss')}">订单时间</td>
							<td th:text="${order.totalPrice}">优惠前金额</td>
							<td th:text="${order.name}">收货人</td>
							<td >
								状态显示
							</td>
							<td>
								<a type="button" href="#" class="btn btn-primary show-detail">详情</a>
								<a type="button" th:attr="data-id=${order.id},data-orderid=${order.orderId}"  class="btn btn-primary create-contract">生成合同</a>
							</td>

						</tr>
						
					</tbody>
				</table>				
				
				<!-- 加入 分页 -->
				<div th:include="/thymeleaf/common/_pager::pager(orderList)" class="pagerx"></div>
				
			</div>
		</div>
		
		<!-- footer -->
		<div th:include="/thymeleaf/common/_footer::footer" class="footer"></div>
		
		<!-- 当用户点击查询条件时，采用些隐藏表单提交 -->
		<form th:action="@{/back/order/show}" method="post"	id="searchform">
			
			<!-- 保存页号与页大小 -->
			<input type="hidden" name="pageNum" id="pageNum" value=""> <input
				type="hidden" name="pageSize" id="pageSize" value="">
	
			<!-- 用户选择的查询条件列表 -->
			<!-- <input type="hidden" name="searchCond" id="searchCond"
				th:value="${searchCond}"> -->
		</form>
		
	</div>
	
	<script type="text/javascript">
	
		/*
			查询-订单
		 */
		function search_normal() {
			$("#searchform").submit(); //提交表单		
		}
		
		/**
		 * 生成隐藏表单域函数
		 * @param {Object} name  
		 * 	input's name
		 * @param {Object} value
		 * 	value:inptu's value
		 */
		var generateHideElement = function(name, value) {
			var tempInput = document.createElement("input");
			tempInput.type = "hidden";
			tempInput.name = name;
			tempInput.value = value;
			return tempInput;
		}
		
		/**
		 * 创建form并提交,创建合同请求
		 * * @param {Object} url
		 * 	提交的地址
		 * @param {Object} id
		 * 	订单id
		 * @param {Object} orderId
		 * 	订单号
		 */
		function createFormAndCommit(url,id,orderId){
			var form = document.createElement("form");
			form.id="test";
			form.name="test";
			document.body.appendChild(form);
	
			//生成隐藏表单中的内容
			var id 		= generateHideElement("id", id), 
				orderId = generateHideElement("orderId", orderId);

			form.appendChild(id);
			form.appendChild(orderId);
			
	
			form.method = "post";
			form.action = url;
			form.submit();
		}
		
		
		
		
	
		$(function(){
			
			/*
				显示【详情】按钮-click
			*/
			$(".show-detail").on("click",function(e){
				
			});
			
			/*
				【创建合同】按钮				
			*/
			$(".create-contract").on("click",function(e){
				var url=BASE_CONTEXT_PATH + "/back/contract/add"; // 需要提交的 url
				var id=$(this).attr("data-id");
				var orderId=$(this).attr("data-orderid");
				
				createFormAndCommit(url,id,orderId); 
			});
			
			
			/*
				【分页】导航：
				当点击页号时读取需要导航到的页码及每页记录数（pageNum,pageSize）
				data-bind:pageNum-pageSize形式
				如果data-bind为空字符串，则不做动作
				当用户点击某页时，则发送与筛选相同的请求
			 */

			$(".pagination li a").on('click', function(e) {
				//alert($(this).attr("data-bind"));
				var dataBind = $(this).attr("data-bind");
				//当dataBind有数据时处理
				if (dataBind != "") {
					var pageArr = new Array();
					pageArr = dataBind.split("-");
					//置隐藏表单数据
					$("#pageNum").val(pageArr[0]);
					$("#pageSize").val(pageArr[1]);
					//发送请求
					search_normal();
				}
	
			});
			
			
		});
	
	</script>
	
	
</body>
</html>